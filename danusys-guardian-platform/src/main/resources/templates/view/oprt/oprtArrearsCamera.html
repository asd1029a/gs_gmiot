<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<h4 class="admin-title">체납카메라 관리</h4>
<ul class="list-condi">
	<li class="list">
		<em>검색조건 : </em>
		<input type="text" id="searchContent" style="width:250px;" onkeypress="if(event.keyCode==13){reload();}" placeholder=""/>
		
		<a href="#" class="select-btn" onclick="reload()">검색</a>
		<a href="#" class="select-btn" onclick="searchClear()">초기화</a>
	</li>
</ul>

<table id="oprtArrearsCameraTable" title="" style="width:99%;height:85%;"></table>

<ul class="right-btn">
	<li class="btn-insert" onClick="openArrearsCameraPopup()">추가</li>
	<li class="btn-insert" onClick="deleteArrearsCamera()">삭제</li>
	<li class="btn-excel" onClick="excelDown('oprtArrearsCameraTable','getArrearsCameraList','arrears_camera_result')">엑셀저장</li>
</ul>
	
<div id="rcv_popup_area" style="display:none;"></div>

<script th:inline="javascript">
$(document).ready(function(){
	reload();
});

var jsonMObj = {};

function reload(){
	var searchContent = $('#searchContent').val();
	
	const jsonObj = {};
	
	jsonObj.searchContent = searchContent;
	
	jsonMObj = jsonObj;
	
	$('#oprtArrearsCameraTable').datagrid({
	    url:'/selectList/oprt.getArrearsCameraList/action',
	    pagination:true,
	    pageSize:20,
	    queryParams : {
			pageSize: 20,
			param : JSON.stringify(jsonObj),
	    },
	    columns:[
			{field: 'rnum', title: '번호', width:'5%', align:'center'},
			{field: 'name', title: '명칭', width:'10%', align:'center'},
			{field: 'latitude', title: '경도', width:'35%', align:'center'},
	        {field: 'longitude', title: '위도', width:'10%', align:'center'},
	        {field: 'insertDate', title: '입력일자', width:'20%', align:'center'},
	        {field: 'updateDate', title: '수정일자', width:'20%', align:'center'}
	    ],
	    onDblClickRow:function(index, row) {
	    	openDetailPopup(index, row);
	    },
	    onLoadSuccess:function(data){
	    	if(data.rows=='sessionOut'){
				alert('로그인 시간이 만료되었습니다.');
				closeWindow();
			}
	    }
	});
}

function searchClear(){
	$('#searchGbn').val('');
	$('#searchContent').val('');
}

function openDetailPopup(index, row) {
	debugger;
	selectedData = row;
	
    const path = "/oprt/popup/oprtArrearsCameraPopup";
    console.log(path);
    common.openDialogPopPosition("oprtArrearsCameraPopup", "체납 카메라 상세", "480", "240", "true", "/action/page.do", {path: path}, path.split("/")[3]);
}


function openArrearsCameraPopup() {
	const path = "/oprt/popup/oprtArrearsCameraPopup";
    console.log(path);
    common.openDialogPopPosition("oprtArrearsCameraPopup", "체납 카메라 추가", "480", "240", "true", "/action/page.do", {path: path}, path.split("/")[3]);
}


function deleteArrearsCamera() {
	var row = $('#oprtArrearsCameraTable').datagrid('getSelected');
	
	if(row == 'undefined' || row==null || row == ''){
		alert("삭제할 글을 선택해 주세요.");
		return;
	}
	
	const jsonObj = {};
    jsonObj.name = row.name;
    
	if(confirm("선택된 카메라를 삭제하시겠습니까?")){
		$.ajax({
		        type       : "POST",
		        url        : "/ajax/delete/oprt.deleteArrearsCamera/action.do",
		        dataType   : "json",
		        data       : {
		        	"param" : JSON.stringify(jsonObj),
		        },
		        async      : false,
		        beforeSend : function(xhr) {
		            // 전송 전 Code
		        }
		    }).done(function (result) {
		    if (result == "SUCCESS") {
		        $('#oprtArrearsCameraTable').datagrid('reload');
		        alert("삭제 완료");
		    }
		    else {
		        alert("삭제 실패");
		    }
		}).fail(function (xhr) {
		    alert("삭제 실패");
		}).always(function() {
		
		});
    }
}


function excelDown(tableNm, sqlId, fileNm) {
	var path = '/excelDownload/oprt.'+sqlId+'/action.do';
	excelDownLoad('#'+tableNm, path, fileNm, jsonMObj);
}

</script>


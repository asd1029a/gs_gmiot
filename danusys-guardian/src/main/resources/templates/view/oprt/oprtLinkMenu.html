<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<h4 class="admin-title">외부연계메뉴 관리</h4>

<ul class="list-condi">
	<li class="list">
		<em>메뉴 명</em>
		<input type="text" id="searchMenuNm" style="width:200px;" onkeypress="if(event.keyCode==13){reload();}"/>
		
		<a href="#" class="select-btn" onclick="reload()">검색</a>
	</li>
</ul>

<table id="oprtLinkMenuTable" title="" style="width:99%;height:85%;"></table>

<ul class="right-btn">
	<li class="btn-insert" onClick="addLinkMenuPopup()">추가</li>
	<li class="btn-modify" onClick="modifyLinkMenuPopup()">수정</li>
	<li class="btn-delete" onClick="deleteLinkMenu()">삭제</li>
</ul>

<script th:inline="javascript">
$(document).ready(function(){
	reload();
});

function reload() {
	const jsonObj = {};
	jsonObj.menuNm = $('#searchMenuNm').val();
	jsonObj.menuGbn = 'service';
	$('#oprtLinkMenuTable').datagrid({
	    url:'/selectList/oprt.getLinkMenuList/action.do',
	    pagination:true,
	    pageSize:20,
	    queryParams : {
			pageSize: 20,
			param : JSON.stringify(jsonObj),
	    },
	    columns:[
	              {field: 'menuGbn', title: '메뉴구분', width:'10%', align:'center'},
	              {field: 'menuId', title: '메뉴 아이디', width:'15%', align:'center'},
	              {field: 'menuNm', title: '메뉴 명', width:'15%', align:'center'},
	              {field: 'path', title: '연결주소', width:'15%', align:'center'},
	              {field: 'iconNm', title: '아이콘', width:'15%', align:'center'},
	              {field: 'sort', title: '순서', width:'10%', align:'center'}
	    ],
	    onLoadSuccess:function(result){
			const rows = result.rows;
	    	if(rows=='sessionOut'){
				alert('로그인 시간이 만료되었습니다.');
				closeWindow();
			}
	    }
	});
}

function addLinkMenuPopup() {
	const path = "oprt/popup/oprtLinkMenuPopup";
	console.log(path);
	common.openDialogPopPosition("oprtLinkMenuPopup", "외부연계메뉴 등록", "500", "588", "true", "/action/page.do", {path: path}, path.split("/")[2]);
}

function modifyLinkMenuPopup() {
	var row = $('#oprtLinkMenuTable').datagrid('getSelected');
	if(row == null) {
		alert('선택 된 정보가 없습니다.');
		return;
	}
	
	selectedData = row;
	const path = "oprt/popup/oprtLinkMenuPopup";
	console.log(path);
	common.openDialogPopPosition("oprtLinkMenuPopup", "외부연계메뉴 수정", "500", "588", "true", "/action/page.do", {path: path}, path.split("/")[2]);
}

function deleteLinkMenu() {
	var chkRows = $('#oprtLinkMenuTable').datagrid('getSelected');
	if(chkRows != null) {
		if(confirm("삭제하시겠습니까?")) {
			const jsonObj = {};
			jsonObj.singleDeleteSid = "oprt.deleteLinkMenu";
			jsonObj.menuId = chkRows.menuId;
			jsonObj.menuGbn = chkRows.menuGbn;
			
		    $.ajax({
		            type       : "POST",
		            url        : "/multiAjax/action.do",
		            dataType   : "json",
		            data : {"param" : JSON.stringify(jsonObj)},
		            async      : false,
		            beforeSend : function(xhr) {
		                // 전송 전 Code
		            }
			}).done(function (result) {
	        	if (result == "SUCCESS") {
					alert("삭제 완료");
					$('#oprtLinkMenuTable').datagrid('reload');
   				}
   				else {
   					alert("삭제 실패");
   				}
		    }).fail(function (xhr) {
		        alert("삭제 실패");
		    }).always(function() {

		    });
		}
	} else {
		alert('선택 된 정보가 없습니다.');
		return;
	}
}
</script>